# 步骤评分方案

## 评分结构
- 定义阶段得分向量 $\mathbf{s} = (s_1, s_2, s_3)$，分别对应“文本预处理”“命名实体识别”“结果核验”。
- 设权重向量 $\boldsymbol{\alpha} = (0.3, 0.5, 0.2)$，总分为
  $$S_{\text{total}} = \sum_{i=1}^{3} \alpha_i s_i,$$
  其中 $s_i \in [0,1]$。
- 若任一阶段未完成，则该阶段得分直接置零。

## 评估准则
1. **文本预处理**：检查是否完成分段、分句与清洗。检测要点：
   - 是否移除前导空白与制表符。
   - 是否控制切分后的子串满足 $|\text{chunk}| \leq 200$ 字符。
2. **命名实体识别**：
   - 调用 LTP 管线并确认模型权重加载成功。
   - 验证是否存在人名、地点、机构三类标签。
3. **结果核验**：
   - 对比输出 JSON 与预期路径 `data/chinese_name_frequency_word.json`。
   - 抽样复核关键实体（如 “苏晴”“李文杰”）。
   - 字符模式下，取上一摘要字符 $c_{t-1}$ 与当前预测字符 $\hat{y}_t$ 拼接得到二字词 $b_t = c_{t-1} \Vert \hat{y}_t$，同步写入指标 `lexical_bigram_candidate`；若 $b_t$ 存在于 `data/chinese_frequency_word.json` 或 `data/chinese_name_frequency_word.json` 中，则触发词表奖励；若未命中但与教师目标一致，则给予回退奖励。
   - 同步记录质量信号，将 `质量×0.5` 加至基础得分、`质量×0.25` 加至潜在得分，保证字符模式的高质量操作能体现在硬指标上。

## 评分伪代码
```pseudo
function ScorePipeline():
    s <- [0, 0, 0]
    if preprocess_ok():
        s[0] <- quality_metric_preprocess()
    if ner_ok():
        s[1] <- model_precision_recall()
    if output_ok():
        s[2] <- schema_consistency()
        if is_character_mode():
            quality_signal <- summary_quality()
            s[0] <- s[0] + 0.5 * quality_signal
            s[1] <- s[1] + 0.25 * quality_signal
            prev_char <- previous_summary_tail()
            bigram <- prev_char ++ current_char()
            record_metric('lexical_bigram_candidate', bigram)
            if exists_in_frequency_tables(bigram, ['data/chinese_frequency_word.json', 'data/chinese_name_frequency_word.json']):
                s[2] <- adjust_with_bigram_bonus(s[2])
            elif matches_teacher_target():
                s[2] <- adjust_with_fallback_bonus(s[2])
    alpha <- [0.3, 0.5, 0.2]
    return dot(alpha, s)
```
