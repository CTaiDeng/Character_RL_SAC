# 当前 Step 打分方案说明

## 文字描述

每个 step 的得分由三部分组成：
1. **终值收益**：在遍历完整个章节序列后，根据认知资本估值扣除累计操作成本与预算透支罚项；
2. **潜能塑形**：在每个阶段比较当前潜能与上一阶段潜能差值，保证最优策略不变的同时提供平滑梯度；
3. **摘要质量软奖励**：即时按章节相似度、覆盖率、关键词匹配度等软指标给出正向奖励，并对乱码/违规用词施加惩罚，使学习过程不完全依赖结构化指令执行。

整体流程如下：

- 策略输出文本由  解析成指令；在未明显遵循指令格式时，解析器会使用自然语言启发式匹配关键词（如“acquire/verify/link”），提高在自由文本下触发指令的概率。
-  执行指令并实时维护事实、验证、对冲、链接集合。
-  按指令类型扣除预算，未列出的指令使用 ；透支额度在奖励中按  计入惩罚。
-  计算覆盖率、多样性、冗余度、验证比例等指标，/ 据此计算资本估值与潜能。
- 终止步骤基础奖励：，其中 ；中间步骤基础奖励仅由预算惩罚组成。
- 潜能差值：，对所有步骤生效。
- 软奖励：
  - 质量奖励：、、 分别作用于字符相似度、覆盖率、新颖度。
  - 词汇奖励：、 分别作用于 TF-IDF 余弦与词频 Jensen-Shannon 相似度。
  - 清洁惩罚：、 对乱码比例与违规用词比例施加非线性惩罚。

最终奖励：

\[
R_t = \underbrace{B_t}_{\text{终值收益}} + \underbrace{\bigl(P_t - P_{t-1}\bigr)}_{\text{潜能塑形}} + \underbrace{S_t}_{\text{摘要质量软奖励}},
\]

其中 $ 使用  对上述软指标做 -(1-x)^k$ 的放大以强化高分段的信号。

## 伪代码



 表示  形态的凸化函数，指数由 、、 控制。

## 参数说明
- **估值权重**：、、、。
- **成本权重**： 控制操作成本惩罚。
- **预算惩罚**： 对透支金额施加线性惩罚。
- **潜能函数**：与估值模型一致，保证策略最优性不受塑形影响。
- **软奖励权重**：、、、 共同决定即时质量反馈的贡献度。

如需调整估值或软奖励项，请同时更新实现与本文档以保持一致。
